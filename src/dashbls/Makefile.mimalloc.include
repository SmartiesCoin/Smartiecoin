# Copyright (c) 2022-2025 The Dash Core developers
# Distributed under the MIT software license, see the accompanying
# file COPYING.MIT or http://www.opensource.org/licenses/mit-license.php.

LIBMIMALLOC = libmimalloc-secure.la

MIMALLOC_CPPFLAGS = \
	-DMI_SECURE=4 \
    -DNDEBUG

MIMALLOC_INCLUDES = \
	-I$(top_srcdir)/depends/mimalloc/include \
	-I$(top_srcdir)/depends/mimalloc/src

MIMALLOC_H = \
    depends/mimalloc/include/mimalloc-new-delete.h \
    depends/mimalloc/include/mimalloc-override.h \
    depends/mimalloc/include/mimalloc-stats.h \
    depends/mimalloc/include/mimalloc.h \
	depends/mimalloc/src/bitmap.h

libmimalloc_secure_la_SOURCES = \
	$(MIMALLOC_H) \
    depends/mimalloc/src/alloc-aligned.c \
    depends/mimalloc/src/alloc-posix.c \
    depends/mimalloc/src/alloc.c \
    depends/mimalloc/src/arena-meta.c \
    depends/mimalloc/src/arena.c \
    depends/mimalloc/src/bitmap.c \
    depends/mimalloc/src/heap.c \
    depends/mimalloc/src/init.c \
    depends/mimalloc/src/libc.c \
    depends/mimalloc/src/options.c \
    depends/mimalloc/src/os.c \
    depends/mimalloc/src/page-map.c \
    depends/mimalloc/src/page.c \
    depends/mimalloc/src/random.c \
    depends/mimalloc/src/stats.c \
    depends/mimalloc/src/prim/prim.c

libmimalloc_secure_la_CPPFLAGS = $(AM_CPPFLAGS) $(MIMALLOC_CPPFLAGS) $(MIMALLOC_INCLUDES)
libmimalloc_secure_la_CXXFLAGS = $(AM_CXXFLAGS)
libmimalloc_secure_la_CFLAGS   = $(AM_CFLAGS)
libmimalloc_secure_la_LDFLAGS  = $(AM_LDFLAGS)

noinst_LTLIBRARIES += $(LIBMIMALLOC)
